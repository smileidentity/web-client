name: test
 on:
   workflow_call:
 jobs:
   test-components:
     runs-on: ubuntu-latest
     defaults:
       run:
         working-directory: ./packages/components
     steps:
       - uses: actions/checkout@v4
       - name: set node version
         uses: actions/setup-node@v3
         with:
           node-version-file: '.nvmrc'
           cache: 'npm'
       - run: npm ci
       - run: npm run build
       - name: run tests
         uses: cypress-io/github-action@v6
         with:
           start: npm start
           working-directory: ./packages/components
           wait-on: 'http://localhost:8000'
   test-embed:
     runs-on: ubuntu-latest
     defaults:
       run:
         working-directory: ./packages/embed
     steps:
       - uses: actions/checkout@v4
       - name: set node version
         uses: actions/setup-node@v3
         with:
           node-version-file: '.nvmrc'
           cache: 'npm'
       - run: npm ci
       - name: run tests
         uses: cypress-io/github-action@v6
         with:
           start: npm start
           working-directory: ./packages/embed
           wait-on: 'http://localhost:8000'
       - name: upload test failure artifacts
         uses: actions/upload-artifact@v3
         if: failure()
         with:
           name: cypress-screenshots
           path: cypress/screenshots
